{% extends 'quiz_app/base.html' %}
{% load form_tags %}
{% block title %}Edit Question{% endblock %}

{% block content %}
<h2>Edit Question for: "{{ quiz.title }}"</h2>
<button type="submit" class="btn modern-btn">üíæ Save Changes</button>

<section class="py-5 modern-bg">
  <div class="container">
    <h2 class="mb-5 text-center fw-bold text-gradient" >‚ûï Add Questions to: <span>"{{ quiz.title }}"</span></h2>

    <div class="row justify-content-center">
      <div class="col-md-8">

        <!-- Add Question Card -->
        <div class="card glass-card mb-4">
          <div class="card-body p-4">
            <h5 class="mb-3 text-muted fw-semibold">üìù New Question</h5>
            <form method="post">
              {% csrf_token %}
              <div class="mb-3">
                {{ form.text.label_tag }}
                {{ form.text|add_class:"form-control modern-input" }}
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  {{ form.option1.label_tag }}
                  {{ form.option1|add_class:"form-control modern-input" }}
                </div>
                <div class="col-md-6 mb-3">
                  {{ form.option2.label_tag }}
                  {{ form.option2|add_class:"form-control modern-input" }}
                </div>
                <div class="col-md-6 mb-3">
                  {{ form.option3.label_tag }}
                  {{ form.option3|add_class:"form-control modern-input" }}
                </div>
                <div class="col-md-6 mb-3">
                  {{ form.option4.label_tag }}
                  {{ form.option4|add_class:"form-control modern-input" }}
                </div>
              </div>
              <div class="mb-3">
                {{ form.correct_answer.label_tag }}
                {{ form.correct_answer|add_class:"form-control modern-input" }}
              </div>
              <div class="d-grid">
                <a href="{% url 'add_question' quiz.id %}" class="btn modern-btn">‚ûï Add Question</a>
              </div>
            </form>
          </div>
        </div>

        <!-- All Questions -->
        <div class="card glass-card">
          <div class="card-body p-4">
            <h5 class="mb-3 text-muted fw-semibold">üìã All Questions</h5>
            {% if questions %}
              <ol class="list-group list-group-numbered modern-list">
                {% for q in questions %}
                  <li class="list-group-item modern-list-item">
                    <strong>{{ q.text }}</strong><br>
                    <span class="option">A.</span> {{ q.option1 }}<br>
                    <span class="option">B.</span> {{ q.option2 }}<br>
                    <span class="option">C.</span> {{ q.option3 }}<br>
                    <span class="option">D.</span> {{ q.option4 }}<br>
                    <span class="correct">‚úî Correct Answer:</span> {{ q.correct_answer }}

                    <div class="mt-2">
                      <a href="{% url 'edit_question' quiz.id q.id %}" class="btn btn-sm btn-warning">‚úè Edit</a>
                      <a href="{% url 'delete_question' quiz.id q.id %}" class="btn btn-sm btn-danger delete-btn">üóë Delete</a>
                    </div>
                  </li>
                {% endfor %}
              </ol>
            {% else %}
              <p class="text-muted">No questions added yet.</p>
            {% endif %}

            <div class="mt-3 text-center">
              <a href="{% url 'dashboard' %}" class="btn modern-outline-btn">‚Üê Back to Dashboard</a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script>
document.querySelector("form").addEventListener("submit", function(e) {
  let inputs = this.querySelectorAll("input, textarea, select");
  for (let input of inputs) {
    if (!input.value.trim()) {
      alert("‚ö† Please fill all fields before submitting!");
      e.preventDefault();
      return;
    }
  }
});
document.querySelectorAll(".delete-btn").forEach(btn => {
  btn.addEventListener("click", function(e) {
    if (!confirm("Are you sure you want to delete this question?")) {
      e.preventDefault();
    }
  });
});
</script>
{% endblock %}
