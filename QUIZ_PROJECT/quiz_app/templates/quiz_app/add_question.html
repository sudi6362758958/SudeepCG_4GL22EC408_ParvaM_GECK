{% extends 'quiz_app/base.html' %}
{% load form_tags %}
{% block title %}Add Question{% endblock %}

{% block content %}
<section class="py-5 modern-bg">
  <div class="container">
    {% if show_questions_block %}
    <h2 class="mb-5 text-center fw-bold text-gradient">
      ‚ûï Add Questions to: <span>"{{ quiz.title }}"</span>
    </h2>
    {% endif %}

    <div class="row justify-content-center">
      <div class="col-md-8">

        {% if show_questions_block %}
<!-- Add Question Card -->
<div class="card glass-card mb-3 shadow-lg border-0 rounded-4">
  <div class="card-body p-4">
    <h5 class="mb-3 text-muted fw-semibold">üìù New Question</h5>
    <form method="post" id="question-form">
      {% csrf_token %}

      <!-- Question Text -->
      <div class="mb-3">
        {{ form.text.label_tag }}
        {{ form.text|add_class:"form-control modern-input shadow-sm" }}
      </div>

      <!-- Options with checkbox for multiple selection -->
      <div class="row g-3">
        <div class="col-md-6">
          <div class="input-group option-card rounded-3 shadow-sm">
            <div class="input-group-text bg-light border-0">
              <input type="checkbox" name="correct_answers" value="option1"
                class="form-check-input mt-0 option-checkbox">
            </div>
            {{ form.option1|add_class:"form-control modern-input border-0" }}
          </div>
        </div>

        <div class="col-md-6">
          <div class="input-group option-card rounded-3 shadow-sm">
            <div class="input-group-text bg-light border-0">
              <input type="checkbox" name="correct_answers" value="option2"
                class="form-check-input mt-0 option-checkbox">
            </div>
            {{ form.option2|add_class:"form-control modern-input border-0" }}
          </div>
        </div>

        <div class="col-md-6">
          <div class="input-group option-card rounded-3 shadow-sm">
            <div class="input-group-text bg-light border-0">
              <input type="checkbox" name="correct_answers" value="option3"
                class="form-check-input mt-0 option-checkbox">
            </div>
            {{ form.option3|add_class:"form-control modern-input border-0" }}
          </div>
        </div>

        <div class="col-md-6">
          <div class="input-group option-card rounded-3 shadow-sm">
            <div class="input-group-text bg-light border-0">
              <input type="checkbox" name="correct_answers" value="option4"
                class="form-check-input mt-0 option-checkbox">
            </div>
            {{ form.option4|add_class:"form-control modern-input border-0" }}
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="d-grid mt-4">
        <button type="submit" class="btn modern-btn py-2 fs-5">
          ‚ûï Add Question
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<!-- All Questions -->
<div class="card glass-card shadow-lg border-0 rounded-4">
  <div class="card-body p-4">
    <h5 class="mb-3 text-muted fw-semibold">üìã All Questions</h5>

    {% if questions %}
    <ol class="list-group list-group-numbered modern-list">
      {% for q in questions %}
      <li class="list-group-item modern-list-item">
        <strong>{{ q.text }}</strong>

        <span class="option {% if 'option1' in q.correct_answers %}correct-answer{% endif %}">
          A. {{ q.option1 }}
        </span>
        <span class="option {% if 'option2' in q.correct_answers %}correct-answer{% endif %}">
          B. {{ q.option2 }}
        </span>
        <span class="option {% if 'option3' in q.correct_answers %}correct-answer{% endif %}">
          C. {{ q.option3 }}
        </span>
        <span class="option {% if 'option4' in q.correct_answers %}correct-answer{% endif %}">
          D. {{ q.option4 }}
        </span>

        <div class="mt-2">
          <a href="{% url 'edit_question' quiz.id q.id %}" class="btn btn-sm btn-warning">‚úè Edit</a>
          <a href="{% url 'delete_question' quiz.id q.id %}" class="btn btn-sm btn-danger delete-btn">üóë Delete</a>
        </div>
      </li>
      {% endfor %}
    </ol>
    {% else %}
    <p class="text-muted">No questions added yet.</p>
    {% endif %}

    <div class="mt-3 text-center">
      <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">‚Üê Back to Dashboard</a>
    </div>
  </div>
</div>

<script>
  // Highlight option while selecting in Add Form
  document.querySelectorAll(".option-checkbox").forEach(checkbox => {
    checkbox.addEventListener("change", function () {
      if (this.checked) {
        this.closest(".option-card").classList.add("selected-correct");
      } else {
        this.closest(".option-card").classList.remove("selected-correct");
      }
    });
  });

  // Validation on submit
  document.querySelector("#question-form")?.addEventListener("submit", function (e) {
    let inputs = this.querySelectorAll("input[type=text], textarea");
    for (let input of inputs) {
      if (!input.value.trim()) {
        alert("‚ö† Please fill all fields before submitting!");
        e.preventDefault();
        return;
      }
    }
    let checked = this.querySelectorAll("input[name='correct_answers']:checked");
    if (checked.length === 0) {
      alert("‚ö† Please select at least one correct answer!");
      e.preventDefault();
    }
  });

  // Confirm before delete
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", function (e) {
      if (!confirm("Are you sure you want to delete this question?")) {
        e.preventDefault();
      }
    });
  });
</script>

<style>
  /* Glass effect card */
  .glass-card {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
  }

  /* Modern Buttons */
  .modern-btn {
    background: linear-gradient(135deg, #ff4e50, #f9d423);
    color: #fff;
    font-weight: bold;
    border: none;
    border-radius: 0.75rem;
    transition: all 0.3s ease;
  }

  .modern-btn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  /* Correct answer style */
  .correct-answer {
    color: #28a745 !important;
    font-weight: 600;
  }

  /* Question List Styling */
  .modern-list {
    text-align: left;
    margin: 0;
    padding: 0;
  }

  .modern-list-item {
    text-align: left;
    padding: 10px 12px;
  }

  /* Option styling */
  .option {
    display: block;
    margin: 2px 0;
    line-height: 1.4;
  }

  /* Small space between question and options */
  .modern-list-item strong {
    display: block;
    margin-bottom: 4px;
  }
</style>
{% endblock %}
